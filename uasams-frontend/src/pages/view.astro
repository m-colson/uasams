---
import Layout from "../layouts/Layout.astro";
---

<Layout title="View - UASAMS">
    <div id="doesntexist">
        <h1>Scholarship does not exist</h1>
        <p>The scholarship you are looking for does not exist.</p>
    </div>
    <div class="container">
        <h1 id="name"></h1>
        <p id="description"></p>
    </div>
</Layout>

<script>
    import PocketBase from "pocketbase";

    const db = new PocketBase("http://localhost:7001");

    if (!db.authStore.isValid) {
        window.location.replace("/login?redirect=/newscholarship");
    }

    const searchParams = new URLSearchParams(window.location.search);

    if (!searchParams.has("id")) {
        window.location.replace("/newscholarship");
    }

    // necessary to prevent type errors
    const model = db.authStore.model as {
        [key: string]: any;
    };

    if (model == undefined) {
        window.location.replace("/login");
    }

    db.collection("scholarships")
        .getOne(searchParams.get("id") as string)
        .then((resp) => {
            const name = document.getElementById("name");
            const description = document.getElementById("description");

            if (name == null || description == null) {
                return;
            }

            name.innerText = resp.data.name;
            description.innerText = resp.data.description;
        })
        .catch((err) => {
            if (err.message == "404") {
                const doesntExist = document.getElementById("doesntexist");

                if (doesntExist == null) {
                    return;
                }

                doesntExist.style.display = "flex";
            }
        });
</script>

<style>
    #doesntexist {
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }
</style>
